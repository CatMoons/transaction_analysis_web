# Проект "ДЗ от SKYPRO"

## Описание:

Проект "ДЗ от SKYPRO" - представляет собой курсовую работу над программой для анализа транзакций, 
которые находятся в Excel-файле

## Обновления:
1. Version 0.1:

Создан новый модуль под названием views:
    Этот модуль содержит новые функции, реализующие генераторы для обработки данных. 
    Такие как:
    
    а. load_user_settings()
    Загружает настройки, специфичные для пользователя, из файла user_settings.json. 
    Возвращает конфигурацию в виде словаря или регистрирует ошибку, если файл не найден или не может быть обработан.

    б. get_exchange_rate()
    Запрашивает текущие курсы обмена, используя API. Получает курсы валют в соответствии со спецификациями пользователя. 
    В случае отсутствия валют или сбоя, соответствующие предупреждения/ошибки регистрируются.

    в. get_stock_price(symbol)
    Получает текущую цену для данного биржевого символа, используя API Alpha Vantage. 
    Логи предоставляются как для успешного получения, так и для ошибок.

    г. fetch_currency_rates()
    обертка для получения курсов валют.

    д. get_greeting(hour)
    Генерирует приветственное сообщение в зависимости от времени суток.

    е. parse_datetime(date_str)
    Парсит строку даты в объект datetime. Эта функция регистрирует процесс парсинга для помощи в отладке.

    ж. def process_excel_data(excel_file_path, specific_date)
    Обрабатывает данные транзакций и возвращает отчет за период от введенной даты до конца месяца в формате JSON.

Создан новый модуль под названием `utils`, который содержит функции для обработки данных с использованием генераторов. 
В данном модуле имеются следующие функции:

    а. transactions_xlsx(filename) 
    Считывает Excel файл с транзакциями и возвращает список словарей этих транзакций.

    в. web_search_xcl(transactions, inputsearch)
    Проводит поиск по категориям в списке транзакций.
    
    г. num_card_account(transactions, user_input)
    Вычисляет сумму всех операций по определенной банковской карте и возвращает значение в формате JSON.

Создан новый модуль под названием services. Этот модуль содержит функции, реализующие различные операции по обработке данных. 
Основные функции, включенные в модуль:

    б. analyze_cashback(data, year, month)
    Данная функция анализирует данные по операциям и рассчитывает суммы кэшбэка для каждой категории за указанный месяц.
    Она принимает на вход данные из Excel файла, анализирует их по указанному году и месяцу, фильтрует и группирует 
    данные по категориям. Результатом выполнения является JSON с суммами кэшбэка по категориям.

    в. extract_phone_numbers(description)
    Эта функция извлекает телефонные номера из строки описания. 
    Использует регулярное выражение для поиска номеров и возвращает найденные номера в виде списка.

    г. get_transactions_with_phones(filepath)`
    Функция извлекает транзакции с телефонными номерами из указанного файла Excel. Она проверяет наличие необходимого 
    столбца, обрабатывает каждую строку, извлекая телефонные номера, и возвращает результат в формате JSON.

Создан новый модуль под названием reports. Этот модуль содержит новые функции, реализующие обработку данных. 
Такие как:

    а. result_report_to_file(file="res_report.txt")
    Декоратор, сохраняющий результат функции в файл.
    Использует логгирование для отслеживания вызовов функций и их результатов.
    Записывает в указанный файл результат выполнения функции.

    в. load_transactions(filepath)
    Загрузка транзакций из Excel файла.

    г. rep_category_spending(transactions, name_category, date)
    Расчёт расходов по указанной категории до заданной даты.

    д. rep_spending_on_weekdays(transactions, date)
    Расчёт расходов по дням недели до заданной даты.

    е. rep_spend_on_working_or_weekends(transactions, date)
    Расчёт расходов на рабочие и выходные дни до заданной даты.  



## Тестирование:
1. Был создан модуль test_views.py в директории tests и были произведены следующие тесты:
- Проверяет успешное считывание настроек пользователя из файла при условии, что файл существует и 
содержит корректные данные.
- Проверяет поведение функции, когда файл настроек пользователя не найден.
- Проверяет обработку ошибки некорректного JSON-формата в файле настроек пользователя.
- Проверяет успешное получение курсов валют от API сервиса. Моделирует успешный ответ сервера с курсами валют
и проверяет корректность возвращаемых курсов.
- Проверяет обработку ошибки при неуспешном ответе сервера. Моделирует ситуацию с ошибочным статусом HTTP и проверяет,
что функция возвращает None.
- Проверяет успешное получение цены акции. Моделирует успешный ответ API получения котировок и проверяет,
что возвращаемая цена соответствует ожидаемой.
- Проверяет, что вызывается исключение ValueError, если API ключ отсутствует.
- Тестирует функцию get_stock_price на случай возникновения RuntimeError, если метод get_quote_endpoint 
выбрасывает исключение. Проверяет, что сообщение об ошибке соответствует ожидаемому.
- Проверяет, что возвращаемое приветствие соответствует времени суток.
- Проверяет, что строка даты и времени корректно преобразуется в объект datetime.
- Создает временный Excel файл с предоставленными данными для тестов и возвращает имя файла.
- Создает временный Excel файл с заданными данными.
- Тестирует функцию process_excel_data при наличии валидных данных в Excel, проверяя, что результат 
соответствует ожидаемым данным.
- Тестирует функцию process_excel_data, проверяя случай, когда в данных
Excel нет записей, соответствующих заданной дате.
- Тестирует обработку данных из Excel-файла с использованием даты в неверном формате.
Этот тест создает временный Excel-файл с данными, содержащими правильный формат даты,
однако затем пытается обработать данные, предоставив дату в неверном формате.
Ожидается, что вызов функции `process_excel_data` с некорректным форматом даты вызовет исключение.
- Тестирует обработку данных из Excel-файла с несуществующим путем к файлу.
Этот тест пытается вызвать функцию `process_excel_data` с именем несуществующего файла.
Ожидается, что при этом будет вызвано исключение из-за невозможности найти файл.

2. Был создан модуль test_utils.py в директории tests и были произведены следующие тесты:
- Тест проверяет, что функция transactions_xlsx возвращает пустой список, когда ей передается пустая строка в качестве 
имени файла.
- Тест проверяет, что функция transactions_xlsx возвращает пустой список, когда передается несуществующее имя файла.
- Тест проверяет, что функция transactions_xlsx правильно считывает данные из существующего файла Excel.
Используется mocker для замены функции pandas.read_excel на фиктивные данные.
- Тест проверяет, что функция web_search_xcl возвращает пустой список в формате JSON,
если в переданных транзакциях нет записей, соответствующих указанной категории.
- Тест проверяет, что функция web_search_xcl возвращает список в формате JSON, содержащий только те транзакции,
где категория совпадает с указанной (включая учет регистра).
- Тест проверяет, что функция num_card_account корректно вычисляет сумму операции для одного результата поиска по 
номеру карты. Сумма округляется до целого числа.
- Тест проверяет, что функция num_card_account вычисляет корректное общее значение суммы операций, когда 
есть несколько транзакций с одинаковым номером карты.
- Тест проверяет, что функция num_card_account возвращает нулевую сумму операций, если в списке транзакций нет
записей с искомым номером карты.
- Тест проверяет, что функция num_card_account возвращает нулевую сумму операций, если список транзакций пуст.

3. Был создан модуль test_services.py в директории tests и были произведены следующие тесты:
- Тестирует функцию analyze_cashback, которая анализирует кэшбэк по транзакциям за указанный месяц и год.
- естирует функцию get_transactions_with_phones, которая извлекает транзакции, содержащие номера телефонов, 
из описания операций.

4. Был создан модуль test_reports.py в директории tests и были произведены следующие тесты:
- Тестирует загрузку транзакций из файла Excel. Использует моки для замены функции pd.read_excel, чтобы проверить, 
что функция load_transactions правильно загружает данные.
- Тестирует функцию, которая генерирует отчет о расходах на определенную категорию.
- Тестирует функцию, которая генерирует отчет о расходах по дням недели. Проверяет, что отчет правильно отображает 
сумму расходов на каждый день недели.
- Тестирует функцию, которая генерирует отчет о расходах в рабочие и выходные дни. Проверяет наличие информации о 
расходах на рабочие и выходные дни в отчете.

## Установка:

1. Клонируйте репозиторий:
```
git clone https://github.com/username/myblog.git
```

2. Установите зависимости:
```
pip install -r requirements.txt
```

3. Создайте базу данных и выполните миграции:
```
python manage.py migrate
```

4. Запустите локальный сервер:
```
python manage.py runserver
```
## Использование:

1. Перейдите на страницу в вашем веб-браузере.
2. Создайте новую учетную запись или войдите существующей.
3. Создайте новую запись в блоге или оставьте комментарий к существующей.

